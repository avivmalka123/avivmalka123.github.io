<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Content Studio âœ¦</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap');

  :root {
    --bg: #080810;
    --surface: #10101c;
    --surface2: #16162a;
    --surface3: #1e1e38;
    --border: rgba(255,255,255,0.07);
    --text: #e8e8f0;
    --text-muted: #6b6b8a;
    --accent: #7c3aed;
    --accent2: #ec4899;
    --accent3: #06b6d4;
    --accent4: #10b981;
    --accent5: #f59e0b;
    --neon: #a855f7;
    --red: #ef4444;
    --glow: rgba(124,58,237,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Heebo', sans-serif; min-height: 100vh; overflow-x: hidden; }

  body::before { content:''; position:fixed; top:-50%; right:-20%; width:600px; height:600px; background:radial-gradient(circle,rgba(124,58,237,0.12) 0%,transparent 70%); pointer-events:none; animation:drift 20s ease-in-out infinite alternate; z-index:0; }
  body::after  { content:''; position:fixed; bottom:-30%; left:-10%;  width:500px; height:500px; background:radial-gradient(circle,rgba(236,72,153,0.08) 0%,transparent 70%); pointer-events:none; animation:drift 25s ease-in-out infinite alternate-reverse; z-index:0; }
  @keyframes drift { 0%{transform:translate(0,0) scale(1)} 100%{transform:translate(40px,60px) scale(1.1)} }

  /* â”€â”€ Header â”€â”€ */
  .header { position:sticky; top:0; z-index:100; background:rgba(8,8,16,0.88); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); padding:0 28px; display:flex; align-items:center; justify-content:space-between; height:64px; }
  .logo { display:flex; align-items:center; gap:12px; font-size:20px; font-weight:800; letter-spacing:-0.5px; }
  .logo-icon { width:38px; height:38px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:18px; box-shadow:0 0 20px var(--glow); }
  .logo span { background:linear-gradient(135deg,#a855f7,#ec4899); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
  .header-actions { display:flex; align-items:center; gap:10px; }
  .date-badge { background:var(--surface2); border:1px solid var(--border); border-radius:8px; padding:6px 14px; font-size:13px; color:var(--text-muted); }

  .btn { display:inline-flex; align-items:center; gap:8px; padding:9px 18px; border-radius:10px; border:none; cursor:pointer; font-family:'Heebo',sans-serif; font-size:14px; font-weight:600; transition:all 0.2s; white-space:nowrap; }
  .btn-primary { background:linear-gradient(135deg,var(--accent),var(--accent2)); color:white; box-shadow:0 4px 20px rgba(124,58,237,0.4); }
  .btn-primary:hover { transform:translateY(-1px); box-shadow:0 6px 28px rgba(124,58,237,0.5); }
  .btn-ghost { background:var(--surface2); border:1px solid var(--border); color:var(--text); }
  .btn-ghost:hover { background:var(--surface3); }
  .btn-icon { width:38px; height:38px; padding:0; justify-content:center; font-size:18px; background:var(--surface2); border:1px solid var(--border); border-radius:10px; color:var(--text); position:relative; }
  .btn-icon:hover { background:var(--surface3); }

  .notif-badge { position:absolute; top:-4px; left:-4px; width:16px; height:16px; background:var(--accent2); border-radius:50%; font-size:9px; font-weight:800; color:white; display:flex; align-items:center; justify-content:center; border:2px solid var(--bg); display:none; }
  .notif-badge.show { display:flex; }

  /* â”€â”€ Tabs â”€â”€ */
  .tabs { display:flex; gap:4px; padding:16px 28px 0; position:relative; z-index:1; }
  .tab { padding:8px 20px; border-radius:10px 10px 0 0; cursor:pointer; font-size:14px; font-weight:600; transition:all 0.2s; color:var(--text-muted); border:1px solid transparent; border-bottom:none; }
  .tab.active { background:var(--surface); color:var(--text); border-color:var(--border); }
  .tab:not(.active):hover { color:var(--text); }

  /* â”€â”€ Main â”€â”€ */
  .main { position:relative; z-index:1; padding:24px 28px; }
  .tab-content { display:none; }
  .tab-content.active { display:block; }

  /* â”€â”€ Stats â”€â”€ */
  .stats-row { display:grid; grid-template-columns:repeat(5,1fr); gap:16px; margin-bottom:28px; }
  .stat-card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:20px; position:relative; overflow:hidden; cursor:pointer; transition:all 0.2s; }
  .stat-card:hover { border-color:rgba(255,255,255,0.15); transform:translateY(-2px); }
  .stat-card::before { content:''; position:absolute; top:0; right:0; width:80px; height:80px; border-radius:50%; opacity:0.15; transform:translate(20px,-20px); }
  .stat-card.idea::before      { background:var(--accent5); }
  .stat-card.production::before{ background:var(--accent3); }
  .stat-card.ready::before     { background:var(--accent4); }
  .stat-card.published::before { background:var(--accent);  }
  .stat-card.total::before     { background:var(--accent2); }
  .stat-label { font-size:12px; color:var(--text-muted); font-weight:600; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:10px; }
  .stat-num   { font-size:36px; font-weight:900; line-height:1; margin-bottom:6px; }
  .stat-card.idea       .stat-num { color:var(--accent5); }
  .stat-card.production .stat-num { color:var(--accent3); }
  .stat-card.ready      .stat-num { color:var(--accent4); }
  .stat-card.published  .stat-num { color:var(--accent);  }
  .stat-card.total      .stat-num { color:var(--accent2); }
  .stat-sub { font-size:12px; color:var(--text-muted); }

  /* â”€â”€ View header â”€â”€ */
  .view-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; flex-wrap:wrap; gap:12px; }
  .view-title  { font-size:18px; font-weight:700; }

  /* â”€â”€ Kanban â”€â”€ */
  .kanban { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; }
  .kanban-col { background:var(--surface); border:1px solid var(--border); border-radius:20px; overflow:hidden; }
  .kanban-col-header { padding:16px 20px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--border); }
  .col-title-wrap { display:flex; align-items:center; gap:10px; }
  .col-dot   { width:10px; height:10px; border-radius:50%; }
  .col-title { font-size:14px; font-weight:700; }
  .col-count { background:var(--surface3); border:1px solid var(--border); border-radius:6px; padding:2px 8px; font-size:12px; font-weight:700; color:var(--text-muted); }
  .kanban-cards { padding:12px; display:flex; flex-direction:column; gap:10px; min-height:100px; }
  .empty-state { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:36px 20px; color:var(--text-muted); gap:10px; text-align:center; }
  .empty-state .empty-icon { font-size:32px; opacity:0.35; }
  .empty-state p { font-size:13px; }

  /* â”€â”€ Cards â”€â”€ */
  .content-card { background:var(--surface2); border:1px solid var(--border); border-radius:14px; padding:14px; cursor:pointer; transition:all 0.2s; position:relative; overflow:hidden; }
  .content-card:hover { border-color:rgba(255,255,255,0.15); transform:translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.3); }
  .card-top { display:flex; align-items:flex-start; justify-content:space-between; gap:8px; margin-bottom:10px; }
  .card-title { font-size:14px; font-weight:700; line-height:1.4; }
  .card-menu-btn { background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:16px; padding:0; line-height:1; flex-shrink:0; transition:color 0.15s; }
  .card-menu-btn:hover { color:var(--text); }
  .card-meta { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .platform-tag { display:inline-flex; align-items:center; gap:5px; padding:3px 8px; border-radius:6px; font-size:11px; font-weight:700; border:1px solid transparent; }
  .date-tag { font-size:11px; color:var(--text-muted); display:flex; align-items:center; gap:4px; }
  .card-desc { font-size:12px; color:var(--text-muted); margin-top:8px; line-height:1.5; }
  .card-actions { display:flex; gap:6px; margin-top:12px; }
  .card-action-btn { flex:1; padding:5px 3px; border-radius:7px; border:1px solid var(--border); background:none; color:var(--text-muted); cursor:pointer; font-family:'Heebo',sans-serif; font-size:11px; font-weight:600; transition:all 0.15s; text-align:center; }
  .card-action-btn:hover { background:var(--surface3); color:var(--text); }
  .card-action-btn.wand { border-color:rgba(168,85,247,0.35); color:var(--neon); }
  .card-action-btn.wand:hover { background:rgba(168,85,247,0.12); }

  /* â”€â”€ Gantt â”€â”€ */
  .gantt-wrap { background:var(--surface); border:1px solid var(--border); border-radius:20px; overflow:hidden; }
  .gantt-scroll { overflow-x:auto; }

  /* â”€â”€ Ideas â”€â”€ */
  .ideas-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
  .idea-card { background:var(--surface); border:1px solid var(--border); border-radius:18px; padding:20px; cursor:pointer; transition:all 0.2s; position:relative; overflow:hidden; }
  .idea-card:hover { border-color:rgba(255,255,255,0.15); transform:translateY(-3px); box-shadow:0 12px 32px rgba(0,0,0,0.3); }
  .idea-card::after { content:''; position:absolute; bottom:0; left:0; right:0; height:2px; background:linear-gradient(90deg,var(--accent),var(--accent2)); opacity:0; transition:opacity 0.2s; }
  .idea-card:hover::after { opacity:1; }
  .idea-emoji { font-size:28px; margin-bottom:12px; }
  .idea-title { font-size:16px; font-weight:700; margin-bottom:8px; }
  .idea-body  { font-size:13px; color:var(--text-muted); line-height:1.6; margin-bottom:14px; }
  .idea-tags  { display:flex; flex-wrap:wrap; gap:6px; }
  .idea-tag   { padding:3px 10px; border-radius:20px; font-size:11px; font-weight:700; background:var(--surface2); border:1px solid var(--border); color:var(--text-muted); }

  /* â”€â”€ Creator Search â”€â”€ */
  .creator-section { background:var(--surface); border:1px solid var(--border); border-radius:20px; padding:24px; margin-bottom:24px; }
  .creator-section-title { font-size:16px; font-weight:700; margin-bottom:16px; display:flex; align-items:center; gap:10px; }
  .creator-search-row { display:flex; gap:10px; align-items:center; }
  .creator-input { flex:1; background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:10px 14px; color:var(--text); font-family:'Heebo',sans-serif; font-size:14px; outline:none; transition:border-color 0.15s; }
  .creator-input:focus { border-color:var(--accent3); box-shadow:0 0 0 3px rgba(6,182,212,0.15); }
  .creator-results { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:12px; margin-top:16px; }

  /* â”€â”€ Analytics â”€â”€ */
  .analytics-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:20px; }
  .analytics-card { background:var(--surface); border:1px solid var(--border); border-radius:20px; padding:24px; }
  .analytics-title { font-size:15px; font-weight:700; margin-bottom:20px; display:flex; align-items:center; gap:8px; }
  .bar-chart { display:flex; flex-direction:column; gap:12px; }
  .bar-item  { display:flex; flex-direction:column; gap:6px; }
  .bar-label-row { display:flex; justify-content:space-between; align-items:center; font-size:13px; }
  .bar-label { font-weight:600; }
  .bar-val   { color:var(--text-muted); font-size:12px; }
  .bar-track { height:8px; background:var(--surface2); border-radius:100px; overflow:hidden; }
  .bar-fill  { height:100%; border-radius:100px; transition:width 0.8s cubic-bezier(0.4,0,0.2,1); }

  /* â”€â”€ Modal base â”€â”€ */
  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(8px); z-index:200; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.2s; }
  .modal-overlay.open { opacity:1; pointer-events:all; }
  .modal { background:var(--surface); border:1px solid rgba(255,255,255,0.12); border-radius:24px; padding:32px; width:100%; max-width:520px; max-height:90vh; overflow-y:auto; position:relative; transform:scale(0.95) translateY(10px); transition:transform 0.2s; box-shadow:0 40px 80px rgba(0,0,0,0.5); }
  .modal-overlay.open .modal { transform:scale(1) translateY(0); }
  .modal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:24px; }
  .modal-title  { font-size:20px; font-weight:800; }
  .modal-close  { background:var(--surface2); border:1px solid var(--border); border-radius:8px; width:32px; height:32px; cursor:pointer; color:var(--text-muted); font-size:16px; display:flex; align-items:center; justify-content:center; transition:all 0.15s; }
  .modal-close:hover { background:var(--surface3); color:var(--text); }
  .modal-footer { display:flex; gap:10px; margin-top:24px; }

  /* â”€â”€ Form â”€â”€ */
  .form-group  { margin-bottom:18px; }
  .form-label  { display:block; font-size:13px; font-weight:700; color:var(--text-muted); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.4px; }
  .form-input, .form-select, .form-textarea { width:100%; background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:10px 14px; color:var(--text); font-family:'Heebo',sans-serif; font-size:14px; outline:none; transition:border-color 0.15s; }
  .form-input:focus, .form-select:focus, .form-textarea:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(124,58,237,0.15); }
  .form-select option { background:var(--surface2); }
  .form-textarea { resize:vertical; min-height:80px; }
  .form-row { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
  .form-help { font-size:11px; color:var(--text-muted); margin-top:6px; line-height:1.5; }
  .form-help a { color:var(--accent3); text-decoration:none; }
  .form-help a:hover { text-decoration:underline; }

  .platform-picker { display:grid; grid-template-columns:repeat(5,1fr); gap:8px; }
  .platform-option { display:flex; flex-direction:column; align-items:center; gap:6px; padding:10px 6px; border-radius:10px; border:1px solid var(--border); cursor:pointer; transition:all 0.15s; font-size:11px; font-weight:600; color:var(--text-muted); background:var(--surface2); }
  .platform-option:hover { border-color:rgba(255,255,255,0.2); color:var(--text); }
  .platform-option.selected { border-color:var(--accent); background:rgba(124,58,237,0.12); color:var(--text); }
  .platform-option .platform-icon { font-size:20px; }

  /* â”€â”€ Settings modal â”€â”€ */
  .settings-tabs { display:flex; gap:4px; background:var(--surface2); border-radius:12px; padding:4px; margin-bottom:24px; }
  .stab { flex:1; padding:8px; border-radius:9px; text-align:center; cursor:pointer; font-size:13px; font-weight:600; color:var(--text-muted); transition:all 0.15s; border:none; background:none; font-family:'Heebo',sans-serif; }
  .stab.active { background:var(--surface3); color:var(--text); }
  .stab-content { display:none; }
  .stab-content.active { display:block; }
  .settings-section-title { font-size:13px; font-weight:700; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:16px; margin-top:20px; }
  .settings-section-title:first-child { margin-top:0; }
  .api-key-input { font-family:monospace; letter-spacing:1px; }
  .notif-toggle-row { display:flex; align-items:center; justify-content:space-between; background:var(--surface2); border:1px solid var(--border); border-radius:12px; padding:14px 16px; margin-bottom:12px; }
  .notif-toggle-label { font-size:14px; font-weight:600; }
  .notif-toggle-sub { font-size:12px; color:var(--text-muted); margin-top:2px; }
  .toggle { width:44px; height:24px; background:var(--surface3); border-radius:100px; position:relative; cursor:pointer; transition:background 0.2s; flex-shrink:0; }
  .toggle.on { background:var(--accent4); }
  .toggle::after { content:''; position:absolute; top:3px; right:3px; width:18px; height:18px; background:white; border-radius:50%; transition:transform 0.2s; }
  .toggle.on::after { transform:translateX(-20px); }

  /* â”€â”€ Script modal â”€â”€ */
  .script-modal .modal { max-width:680px; }
  .script-platform-badge { display:inline-flex; align-items:center; gap:6px; padding:4px 12px; border-radius:20px; font-size:12px; font-weight:700; margin-top:6px; }
  .script-body { display:flex; flex-direction:column; gap:14px; margin-top:20px; }
  .script-section { background:var(--surface2); border:1px solid var(--border); border-radius:14px; padding:16px; }
  .script-section-label { font-size:11px; font-weight:800; text-transform:uppercase; letter-spacing:0.8px; color:var(--text-muted); margin-bottom:8px; }
  .script-section-content { font-size:14px; line-height:1.75; white-space:pre-wrap; }
  .script-copy-bar { display:flex; gap:10px; margin-top:20px; align-items:center; }
  .script-char-count { font-size:12px; color:var(--text-muted); flex:1; }

  /* â”€â”€ Loading â”€â”€ */
  .loading-wrap { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:40px; gap:16px; }
  .spinner { width:36px; height:36px; border:3px solid rgba(168,85,247,0.2); border-top-color:var(--neon); border-radius:50%; animation:spin 0.7s linear infinite; }
  @keyframes spin { to { transform:rotate(360deg); } }
  .loading-text { font-size:14px; color:var(--text-muted); font-weight:600; animation:pulse 1.5s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:0.5} 50%{opacity:1} }

  /* â”€â”€ AI glow button â”€â”€ */
  .btn-ai { background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(236,72,153,0.2)); border:1px solid rgba(168,85,247,0.4); color:var(--neon); }
  .btn-ai:hover { background:linear-gradient(135deg,rgba(168,85,247,0.3),rgba(236,72,153,0.3)); border-color:var(--neon); box-shadow:0 0 20px rgba(168,85,247,0.3); }

  /* â”€â”€ Context menu â”€â”€ */
  .ctx-menu { position:fixed; background:var(--surface2); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:6px; z-index:300; box-shadow:0 20px 40px rgba(0,0,0,0.4); min-width:160px; display:none; }
  .ctx-menu.open { display:block; }
  .ctx-item { padding:8px 14px; border-radius:8px; cursor:pointer; font-size:13px; font-weight:600; transition:all 0.15s; display:flex; align-items:center; gap:10px; color:var(--text); }
  .ctx-item:hover { background:var(--surface3); }
  .ctx-item.danger { color:var(--red); }
  .ctx-item.danger:hover { background:rgba(239,68,68,0.1); }
  .ctx-divider { height:1px; background:var(--border); margin:4px 0; }

  /* â”€â”€ Notification toast â”€â”€ */
  .notification { position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(80px); background:var(--surface2); border:1px solid rgba(255,255,255,0.12); border-radius:12px; padding:12px 20px; font-size:14px; font-weight:600; z-index:400; transition:transform 0.3s cubic-bezier(0.34,1.56,0.64,1); box-shadow:0 16px 40px rgba(0,0,0,0.4); display:flex; align-items:center; gap:10px; }
  .notification.show { transform:translateX(-50%) translateY(0); }

  /* â”€â”€ Error â”€â”€ */
  .error-box { background:rgba(239,68,68,0.1); border:1px solid rgba(239,68,68,0.3); border-radius:12px; padding:14px 16px; font-size:13px; color:#fca5a5; display:flex; gap:10px; align-items:flex-start; line-height:1.5; }

  /* â”€â”€ Scrollbar â”€â”€ */
  ::-webkit-scrollbar { width:6px; height:6px; }
  ::-webkit-scrollbar-track { background:transparent; }
  ::-webkit-scrollbar-thumb { background:var(--surface3); border-radius:3px; }
  ::-webkit-scrollbar-thumb:hover { background:rgba(255,255,255,0.2); }

  @media(max-width:1100px) {
    .stats-row { grid-template-columns:repeat(3,1fr); }
    .kanban { grid-template-columns:repeat(2,1fr); }
    .analytics-grid { grid-template-columns:1fr; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="header">
  <div class="logo">
    <div class="logo-icon">âœ¦</div>
    <span>Content Studio</span>
  </div>
  <div class="header-actions">
    <div class="date-badge" id="currentDate"></div>
    <button class="btn btn-ai" onclick="openAIIdeasModal()">âœ¨ AI Ideas</button>
    <button class="btn-icon btn" id="notifBtn" onclick="openSettings('notif')" title="×”×ª×¨××•×ª">
      ğŸ””
      <span class="notif-badge" id="notifBadge">!</span>
    </button>
    <button class="btn-icon btn" onclick="openSettings('ai')" title="×”×’×“×¨×•×ª">âš™ï¸</button>
    <button class="btn btn-primary" onclick="openModal()">+ ×ª×•×›×Ÿ ×—×“×©</button>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tabs">
  <div class="tab active" onclick="switchTab('board',this)">ğŸ“‹ ×œ×•×— ×ª×•×›×Ÿ</div>
  <div class="tab" onclick="switchTab('gantt',this)">ğŸ“… ×¦×™×¨ ×–××Ÿ</div>
  <div class="tab" onclick="switchTab('ideas',this)">ğŸ’¡ ×¨×¢×™×•× ×•×ª</div>
  <div class="tab" onclick="switchTab('analytics',this)">ğŸ“Š × ×™×ª×•×—</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="main">

  <!-- Stats -->
  <div class="stats-row">
    <div class="stat-card idea"       onclick="filterByStatus('idea')">      <div class="stat-label">×¨×¢×™×•× ×•×ª</div>    <div class="stat-num" id="stat-idea">0</div>      <div class="stat-sub">×××ª×™× ×™× ×œ×™×™×¦×•×¨</div></div>
    <div class="stat-card production" onclick="filterByStatus('production')"><div class="stat-label">×‘×™×™×¦×•×¨</div>     <div class="stat-num" id="stat-production">0</div><div class="stat-sub">×¢×•×‘×“×™× ×¢×œ×™×”×</div></div>
    <div class="stat-card ready"      onclick="filterByStatus('ready')">     <div class="stat-label">××•×›×Ÿ</div>      <div class="stat-num" id="stat-ready">0</div>     <div class="stat-sub">××—×›×™× ×œ×¤×¨×¡×•×</div></div>
    <div class="stat-card published"  onclick="filterByStatus('published')"> <div class="stat-label">×¤×•×¨×¡×</div>     <div class="stat-num" id="stat-published">0</div>  <div class="stat-sub">×—×™×™× ×‘×¨×©×ª</div></div>
    <div class="stat-card total">                                             <div class="stat-label">×¡×”"×›</div>      <div class="stat-num" id="stat-total">0</div>      <div class="stat-sub">×¤×™×¡×•×ª ×ª×•×›×Ÿ</div></div>
  </div>

  <!-- â”€â”€ TAB: Board â”€â”€ -->
  <div class="tab-content active" id="tab-board">
    <div class="view-header">
      <div class="view-title">×œ×•×— ×ª×•×›×Ÿ</div>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
        <select class="form-select" style="width:auto;padding:6px 12px;font-size:13px;" id="platformFilter" onchange="renderBoard()">
          <option value="">×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª</option>
          <option value="instagram">Instagram</option>
          <option value="tiktok">TikTok</option>
          <option value="youtube">YouTube</option>
          <option value="twitter">Twitter/X</option>
          <option value="linkedin">LinkedIn</option>
        </select>
      </div>
    </div>
    <div class="kanban" id="kanban-board"></div>
  </div>

  <!-- â”€â”€ TAB: Gantt â”€â”€ -->
  <div class="tab-content" id="tab-gantt">
    <div class="view-header">
      <div class="view-title">×¦×™×¨ ×–××Ÿ â€” Gantt</div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ghost" onclick="shiftGantt(-1)">â—€ ×—×•×“×© ×§×•×“×</button>
        <button class="btn btn-ghost" onclick="shiftGantt(0)">×”×™×•×</button>
        <button class="btn btn-ghost" onclick="shiftGantt(1)">×—×•×“×© ×”×‘× â–¶</button>
      </div>
    </div>
    <div class="gantt-wrap"><div class="gantt-scroll"><div id="gantt-container"></div></div></div>
  </div>

  <!-- â”€â”€ TAB: Ideas â”€â”€ -->
  <div class="tab-content" id="tab-ideas">
    <!-- Creator Inspiration -->
    <div class="creator-section">
      <div class="creator-section-title">ğŸ” ×”×©×¨××” ××™×•×¦×¨×™×</div>
      <div class="creator-search-row">
        <input class="creator-input" id="creatorInput" placeholder="×©× ×™×•×¦×¨ ×ª×•×›×Ÿ... (×œ××©×œ: MrBeast, ×§×©×ª 12, Gary Vee)" onkeydown="if(event.key==='Enter')searchCreator()">
        <button class="btn btn-ai" onclick="searchCreator()" id="creatorBtn">ğŸ” ×—×¤×© ×•×¦×•×¨ ×¨×¢×™×•× ×•×ª</button>
      </div>
      <div class="creator-results" id="creatorResults"></div>
    </div>

    <!-- Ideas -->
    <div class="view-header">
      <div class="view-title">×‘× ×§ ×¨×¢×™×•× ×•×ª ğŸ’¡</div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ai" onclick="openAIIdeasModal()">âœ¨ ×¦×•×¨ ×¨×¢×™×•× ×•×ª ×¢× AI</button>
        <button class="btn btn-primary" onclick="openIdeaModal()">+ ×¨×¢×™×•×Ÿ ×—×“×©</button>
      </div>
    </div>
    <div class="ideas-grid" id="ideas-grid"></div>
  </div>

  <!-- â”€â”€ TAB: Analytics â”€â”€ -->
  <div class="tab-content" id="tab-analytics">
    <div class="view-header"><div class="view-title">× ×™×ª×•×— ×ª×•×›×Ÿ ğŸ“Š</div></div>
    <div class="analytics-grid" id="analytics-grid"></div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL: Content â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="contentModal" onclick="handleOverlayClick(event,'contentModal',closeModal)">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">×ª×•×›×Ÿ ×—×“×© âœ¦</div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="form-group">
      <label class="form-label">×›×•×ª×¨×ª</label>
      <input class="form-input" id="f-title" placeholder="×©× ×”×¤×•×¡×˜ / ×¡×¨×˜×•×Ÿ..." autocomplete="off">
    </div>
    <div class="form-group">
      <label class="form-label">×¤×œ×˜×¤×•×¨××”</label>
      <div class="platform-picker" id="platformPicker">
        <div class="platform-option selected" data-platform="instagram" onclick="selectPlatform(this)"><span class="platform-icon">ğŸ“¸</span>Instagram</div>
        <div class="platform-option" data-platform="tiktok"    onclick="selectPlatform(this)"><span class="platform-icon">ğŸµ</span>TikTok</div>
        <div class="platform-option" data-platform="youtube"   onclick="selectPlatform(this)"><span class="platform-icon">â–¶ï¸</span>YouTube</div>
        <div class="platform-option" data-platform="twitter"   onclick="selectPlatform(this)"><span class="platform-icon">ğ•</span>Twitter</div>
        <div class="platform-option" data-platform="linkedin"  onclick="selectPlatform(this)"><span class="platform-icon">ğŸ’¼</span>LinkedIn</div>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">×ª××¨×™×š ×”×ª×—×œ×”</label><input class="form-input" type="date" id="f-start"></div>
      <div class="form-group"><label class="form-label">×ª××¨×™×š ×¤×¨×¡×•×</label><input class="form-input" type="date" id="f-end"></div>
    </div>
    <div class="form-group">
      <label class="form-label">×¡×˜×˜×•×¡</label>
      <select class="form-select" id="f-status">
        <option value="idea">ğŸ’¡ ×¨×¢×™×•×Ÿ</option>
        <option value="production">ğŸ¬ ×‘×™×™×¦×•×¨</option>
        <option value="ready">âœ… ××•×›×Ÿ</option>
        <option value="published">ğŸš€ ×¤×•×¨×¡×</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">×ª×™××•×¨ / ×”×¢×¨×•×ª</label>
      <textarea class="form-textarea" id="f-desc" placeholder="× ×•×©×, ×§×”×œ ×™×¢×“, ×”×•×§ ×¤×ª×™×—×”..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="saveContent()">×©××•×¨ ×ª×•×›×Ÿ</button>
      <button class="btn btn-ghost"   onclick="closeModal()">×‘×™×˜×•×œ</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL: Idea â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="ideaModal" onclick="handleOverlayClick(event,'ideaModal',closeIdeaModal)">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">×¨×¢×™×•×Ÿ ×—×“×© ğŸ’¡</div>
      <button class="modal-close" onclick="closeIdeaModal()">âœ•</button>
    </div>
    <div class="form-group"><label class="form-label">×›×•×ª×¨×ª ×”×¨×¢×™×•×Ÿ</label><input class="form-input" id="i-title" placeholder="×©× ×”×¨×¢×™×•×Ÿ..." autocomplete="off"></div>
    <div class="form-group"><label class="form-label">×××•×’'×™</label><input class="form-input" id="i-emoji" placeholder="ğŸ’¡" style="width:80px;text-align:center;font-size:20px;"></div>
    <div class="form-group"><label class="form-label">×ª×™××•×¨</label><textarea class="form-textarea" id="i-body" placeholder="×¡×¤×¨ ×¢×œ ×”×¨×¢×™×•×Ÿ..."></textarea></div>
    <div class="form-group"><label class="form-label">×ª×’×™×•×ª (××•×¤×¨×“×•×ª ×‘×¤×¡×™×§×™×)</label><input class="form-input" id="i-tags" placeholder="×•×™×¨××œ×™, ×—×™× ×•×›×™, ××•×˜×™×‘×¦×™×”..."></div>
    <div class="modal-footer">
      <button class="btn btn-primary" onclick="saveIdea()">×©××•×¨ ×¨×¢×™×•×Ÿ</button>
      <button class="btn btn-ghost"   onclick="closeIdeaModal()">×‘×™×˜×•×œ</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL: AI Ideas â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="aiIdeasModal" onclick="handleOverlayClick(event,'aiIdeasModal',closeAIIdeasModal)">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">âœ¨ ×™×¦×™×¨×ª ×¨×¢×™×•× ×•×ª ×¢× AI</div>
      <button class="modal-close" onclick="closeAIIdeasModal()">âœ•</button>
    </div>
    <div class="form-group">
      <label class="form-label">×”× ×™×©×” ×©×œ×š</label>
      <input class="form-input" id="ai-niche" placeholder="×œ××©×œ: ×›×•×©×¨ ×•×‘×¨×™××•×ª, ×¤×™× × ×¡×™×, ×‘×™×©×•×œ, ×˜×›× ×•×œ×•×’×™×”..." autocomplete="off">
      <div class="form-help">××” ×”× ×™×©×” / ×ª×—×•× ×”×ª×•×›×Ÿ ×©×œ×š? ×›×›×œ ×©×ª×”×™×” ×¡×¤×¦×™×¤×™ ×™×•×ª×¨, ×”×¨×¢×™×•× ×•×ª ×™×”×™×• ×˜×•×‘×™× ×™×•×ª×¨.</div>
    </div>
    <div class="form-group">
      <label class="form-label">×¤×œ×˜×¤×•×¨××” (××•×¤×¦×™×•× ×œ×™)</label>
      <select class="form-select" id="ai-platform">
        <option value="">×›×œ ×”×¤×œ×˜×¤×•×¨××•×ª</option>
        <option value="Instagram Reels">Instagram Reels</option>
        <option value="TikTok">TikTok</option>
        <option value="YouTube">YouTube</option>
        <option value="Twitter/X">Twitter/X</option>
        <option value="LinkedIn">LinkedIn</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">×›××” ×¨×¢×™×•× ×•×ª?</label>
      <select class="form-select" id="ai-count">
        <option value="5">5 ×¨×¢×™×•× ×•×ª</option>
        <option value="10" selected>10 ×¨×¢×™×•× ×•×ª</option>
        <option value="15">15 ×¨×¢×™×•× ×•×ª</option>
      </select>
    </div>
    <div id="aiIdeasResult"></div>
    <div class="modal-footer">
      <button class="btn btn-primary btn-ai" id="aiGenerateBtn" onclick="runAIIdeas()">âœ¨ ×¦×•×¨ ×¨×¢×™×•× ×•×ª</button>
      <button class="btn btn-ghost" onclick="closeAIIdeasModal()">×‘×™×˜×•×œ</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL: Script â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay script-modal" id="scriptModal" onclick="handleOverlayClick(event,'scriptModal',closeScriptModal)">
  <div class="modal" style="max-width:680px;">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="scriptTitle">ğŸª„ ×¡×§×¨×™×¤×˜</div>
        <div id="scriptPlatformBadge" style="margin-top:6px;"></div>
      </div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ghost" onclick="copyScript()" id="copyScriptBtn" style="display:none;">ğŸ“‹ ×”×¢×ª×§</button>
        <button class="modal-close" onclick="closeScriptModal()">âœ•</button>
      </div>
    </div>
    <div id="scriptContent"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODAL: Settings â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="settingsModal" onclick="handleOverlayClick(event,'settingsModal',closeSettings)">
  <div class="modal" style="max-width:560px;">
    <div class="modal-header">
      <div class="modal-title">âš™ï¸ ×”×’×“×¨×•×ª</div>
      <button class="modal-close" onclick="closeSettings()">âœ•</button>
    </div>

    <div class="settings-tabs">
      <button class="stab active" id="stab-ai"     onclick="switchStab('ai',this)">ğŸ¤– AI</button>
      <button class="stab"        id="stab-notif"  onclick="switchStab('notif',this)">ğŸ”” ×”×ª×¨××•×ª</button>
      <button class="stab"        id="stab-creator" onclick="switchStab('creator',this)">ğŸ” ×™×•×¦×¨×™×</button>
    </div>

    <!-- AI Tab -->
    <div class="stab-content active" id="sc-ai">
      <div class="settings-section-title">××¤×ª×— Claude API</div>
      <div class="form-group">
        <label class="form-label">API Key</label>
        <input class="form-input api-key-input" id="s-claude-key" type="password" placeholder="sk-ant-api...">
        <div class="form-help">
          ×§×‘×œ ××¤×ª×— ×‘×—×™× × ×‘: <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a> â€” × ×“×¨×© ×œ×›×œ ×¤×™×¦'×¨×™ ×”-AI
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">×”× ×™×©×” ×©×œ×š (×‘×¨×™×¨×ª ××—×“×œ)</label>
        <input class="form-input" id="s-niche" placeholder="×œ××©×œ: ×›×•×©×¨ ×•×‘×¨×™××•×ª, ×‘×™×–× ×¡, ×§×¨×™××™×™×˜×™×‘...">
      </div>
    </div>

    <!-- Notifications Tab -->
    <div class="stab-content" id="sc-notif">
      <div class="settings-section-title">×”×ª×¨××” ×™×•××™×ª ×‘×©×¢×” 9:00</div>

      <div class="notif-toggle-row">
        <div>
          <div class="notif-toggle-label">ğŸŒ ×”×ª×¨××ª ×“×¤×“×¤×Ÿ</div>
          <div class="notif-toggle-sub">××•×¤×™×¢×” ×›×©×”××ª×¨ ×¤×ª×•×— ×‘×“×¤×“×¤×Ÿ</div>
        </div>
        <div class="toggle" id="browserNotifToggle" onclick="toggleBrowserNotif(this)"></div>
      </div>

      <div class="settings-section-title">ğŸ“± ntfy.sh â€” ×”×•×“×¢×” ×œ× ×™×™×“ (×—×™× ×)</div>
      <div class="form-group">
        <label class="form-label">Topic ×©×œ×š ×‘-ntfy</label>
        <input class="form-input" id="s-ntfy" placeholder="content-studio-aviv123">
        <div class="form-help">
          1. ×”×•×¨×“ <a href="https://ntfy.sh/" target="_blank">ntfy app</a> ×œ× ×™×™×“<br>
          2. ×”×™×¨×©× ×œ-topic ×©×ª×‘×—×¨ (×›×œ ×©× ×™×™×—×•×“×™)<br>
          3. ×”×“×‘×§ ××•×ª×• ×›××Ÿ â€” ×ª×§×‘×œ ×”×•×“×¢×” ×›×œ ×‘×•×§×¨ ×‘-9:00
        </div>
      </div>

      <div class="settings-section-title">ğŸ’¬ WhatsApp (CallMeBot)</div>
      <div class="form-group">
        <label class="form-label">××¡×¤×¨ ×˜×œ×¤×•×Ÿ</label>
        <input class="form-input" id="s-wb-phone" placeholder="972501234567" style="direction:ltr;">
        <div class="form-help">×¤×•×¨××˜ ×‘×™× ×œ××•××™ ×œ×œ× + (×œ××©×œ: 972501234567)</div>
      </div>
      <div class="form-group">
        <label class="form-label">CallMeBot API Key</label>
        <input class="form-input api-key-input" id="s-wb-key" placeholder="1234567">
        <div class="form-help">
          ×œ×§×‘×œ ××¤×ª×—: ×©×œ×— "I allow callmebot to send me messages" ×œ-<strong>+34 644 59 56 09</strong> ×‘×•×•××¦××¤ â€” ×ª×§×‘×œ API key ×‘×”×•×“×¢×” ×—×–×¨×”
        </div>
      </div>

      <button class="btn btn-ghost" style="width:100%;margin-top:8px;" onclick="testNotifications()">ğŸ§ª ×©×œ×— ×”×•×“×¢×ª ×‘×“×™×§×”</button>
    </div>

    <!-- Creator Tab -->
    <div class="stab-content" id="sc-creator">
      <div class="settings-section-title">YouTube Data API (××•×¤×¦×™×•× ×œ×™)</div>
      <div class="form-group">
        <label class="form-label">YouTube API Key</label>
        <input class="form-input api-key-input" id="s-yt-key" type="password" placeholder="AIza...">
        <div class="form-help">
          ×× ×ª×•×¡×™×£ ××¤×ª×—, ×”×—×™×¤×•×© ×™×¦×™×’ ×¡×¨×˜×•× ×™× ×××™×ª×™×™× ×©×œ ×”×™×•×¦×¨.<br>
          ×œ×œ× ××¤×ª×— â€” ×”-AI ×™×©×ª××© ×‘×™×“×¢ ×©×œ×• ×¢×œ ×”×™×•×¦×¨. ×©× ×™ ×”××•×¤×¦×™×•×ª ×¢×•×‘×“×•×ª!<br>
          <a href="https://console.cloud.google.com/" target="_blank">console.cloud.google.com</a> â†’ Enable YouTube Data API v3 (×—×™× × ×¢×“ 100 ×—×™×¤×•×©×™×/×™×•×)
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary" onclick="saveSettings()">×©××•×¨ ×”×’×“×¨×•×ª</button>
      <button class="btn btn-ghost" onclick="closeSettings()">×‘×™×˜×•×œ</button>
    </div>
  </div>
</div>

<!-- Context Menu -->
<div class="ctx-menu" id="ctxMenu">
  <div class="ctx-item" onclick="ctxEdit()">âœï¸ ×¢×¨×•×š</div>
  <div class="ctx-item" onclick="ctxWand()">ğŸª„ ×¡×§×¨×™×¤×˜</div>
  <div class="ctx-item" onclick="ctxAdvanceStatus()">â­ï¸ ×§×“× ×¡×˜×˜×•×¡</div>
  <div class="ctx-divider"></div>
  <div class="ctx-item danger" onclick="ctxDelete()">ğŸ—‘ï¸ ××—×§</div>
</div>

<!-- Notification Toast -->
<div class="notification" id="notification">
  <span id="notif-icon">âœ“</span>
  <span id="notif-msg">× ×©××¨!</span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONSTANTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PLATFORMS = {
  instagram:{ label:'Instagram', icon:'ğŸ“¸', color:'#ec4899', bg:'rgba(236,72,153,0.15)', border:'rgba(236,72,153,0.3)' },
  tiktok:   { label:'TikTok',    icon:'ğŸµ', color:'#06b6d4', bg:'rgba(6,182,212,0.15)',  border:'rgba(6,182,212,0.3)'  },
  youtube:  { label:'YouTube',   icon:'â–¶ï¸', color:'#ef4444', bg:'rgba(239,68,68,0.15)',  border:'rgba(239,68,68,0.3)'  },
  twitter:  { label:'Twitter/X', icon:'ğ•',  color:'#94a3b8', bg:'rgba(148,163,184,0.15)',border:'rgba(148,163,184,0.3)'},
  linkedin: { label:'LinkedIn',  icon:'ğŸ’¼', color:'#3b82f6', bg:'rgba(59,130,246,0.15)', border:'rgba(59,130,246,0.3)' },
};
const STATUSES = {
  idea:       { label:'ğŸ’¡ ×¨×¢×™×•×Ÿ',  color:'#f59e0b', ganttColor:'linear-gradient(90deg,#f59e0b,#fbbf24)' },
  production: { label:'ğŸ¬ ×‘×™×™×¦×•×¨', color:'#06b6d4', ganttColor:'linear-gradient(90deg,#06b6d4,#38bdf8)' },
  ready:      { label:'âœ… ××•×›×Ÿ',   color:'#10b981', ganttColor:'linear-gradient(90deg,#10b981,#34d399)' },
  published:  { label:'ğŸš€ ×¤×•×¨×¡×',  color:'#a855f7', ganttColor:'linear-gradient(90deg,#a855f7,#c084fc)' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let contents = JSON.parse(localStorage.getItem('cs_contents') || '[]');
let ideas    = JSON.parse(localStorage.getItem('cs_ideas')    || '[]');
let editingId     = null;
let editingIdeaId = null;
let ctxId         = null;
let ganttOffset   = 0;
let statusFilter  = null;
let generatedScript = '';

function save() {
  localStorage.setItem('cs_contents', JSON.stringify(contents));
  localStorage.setItem('cs_ideas',    JSON.stringify(ideas));
}
function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2); }
function formatDate(s) { if(!s) return ''; return new Date(s+'T12:00:00').toLocaleDateString('he-IL',{day:'numeric',month:'short'}); }
function notify(msg,icon='âœ“') {
  const el = document.getElementById('notification');
  document.getElementById('notif-msg').textContent = msg;
  document.getElementById('notif-icon').textContent = icon;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gs(k)    { return localStorage.getItem('cs_'+k)||''; }
function ss(k,v)  { localStorage.setItem('cs_'+k,v); }

function openSettings(tab='ai') {
  document.getElementById('s-claude-key').value = gs('claude_key');
  document.getElementById('s-niche').value      = gs('niche');
  document.getElementById('s-ntfy').value       = gs('ntfy_topic');
  document.getElementById('s-wb-phone').value   = gs('wb_phone');
  document.getElementById('s-wb-key').value     = gs('wb_key');
  document.getElementById('s-yt-key').value     = gs('yt_key');
  // Browser notif toggle
  const tog = document.getElementById('browserNotifToggle');
  tog.classList.toggle('on', gs('browser_notif')==='1' && Notification.permission==='granted');
  switchStab(tab, document.getElementById('stab-'+tab));
  document.getElementById('settingsModal').classList.add('open');
}
function closeSettings() { document.getElementById('settingsModal').classList.remove('open'); }
function saveSettings() {
  ss('claude_key', document.getElementById('s-claude-key').value.trim());
  ss('niche',      document.getElementById('s-niche').value.trim());
  ss('ntfy_topic', document.getElementById('s-ntfy').value.trim());
  ss('wb_phone',   document.getElementById('s-wb-phone').value.trim());
  ss('wb_key',     document.getElementById('s-wb-key').value.trim());
  ss('yt_key',     document.getElementById('s-yt-key').value.trim());
  closeSettings();
  notify('×”×’×“×¨×•×ª × ×©××¨×• âœ“');
  initNotifications();
}

function switchStab(name, el) {
  document.querySelectorAll('.stab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.stab-content').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('sc-'+name).classList.add('active');
}

async function toggleBrowserNotif(el) {
  if (el.classList.contains('on')) {
    el.classList.remove('on');
    ss('browser_notif','0');
  } else {
    const perm = await Notification.requestPermission();
    if (perm==='granted') { el.classList.add('on'); ss('browser_notif','1'); notify('×”×ª×¨××•×ª ×”×•×¤×¢×œ×• âœ“','ğŸ””'); }
    else notify('×œ× × ×™×ª×Ÿ ×œ×§×‘×œ ×”×¨×©××” â€” ××©×¨ ×‘×“×¤×“×¤×Ÿ','âš ï¸');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CLAUDE API â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function callClaude(userPrompt, systemPrompt='', maxTokens=1500) {
  const key = gs('claude_key');
  if (!key) { openSettings('ai'); throw new Error('× ×“×¨×© ××¤×ª×— Claude API â€” ×”×•×¡×£ ×‘×”×’×“×¨×•×ª âš™ï¸'); }

  const body = { model:'claude-haiku-4-5-20251001', max_tokens:maxTokens, messages:[{role:'user',content:userPrompt}] };
  if (systemPrompt) body.system = systemPrompt;

  const resp = await fetch('https://api.anthropic.com/v1/messages', {
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'x-api-key': key,
      'anthropic-version':'2023-06-01',
      'anthropic-dangerous-direct-browser-access':'true'
    },
    body: JSON.stringify(body)
  });

  if (!resp.ok) {
    const err = await resp.json().catch(()=>({}));
    throw new Error(err.error?.message || `×©×’×™××ª API: ${resp.status}`);
  }
  const data = await resp.json();
  return data.content[0].text;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AI IDEAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAIIdeasModal() {
  document.getElementById('ai-niche').value = gs('niche') || '';
  document.getElementById('aiIdeasResult').innerHTML = '';
  document.getElementById('aiIdeasModal').classList.add('open');
  setTimeout(()=>document.getElementById('ai-niche').focus(),100);
}
function closeAIIdeasModal() { document.getElementById('aiIdeasModal').classList.remove('open'); }

async function runAIIdeas() {
  const niche   = document.getElementById('ai-niche').value.trim();
  const platform= document.getElementById('ai-platform').value;
  const count   = document.getElementById('ai-count').value;
  if (!niche) { document.getElementById('ai-niche').style.borderColor='var(--red)'; return; }
  document.getElementById('ai-niche').style.borderColor='';

  const btn = document.getElementById('aiGenerateBtn');
  btn.disabled=true; btn.textContent='â³ ×™×•×¦×¨...';
  document.getElementById('aiIdeasResult').innerHTML = loadingHTML('AI ×™×•×¦×¨ ×¨×¢×™×•× ×•×ª...');

  const sys = `××ª×” ××¡×˜×¨×˜×’ ×ª×•×›×Ÿ ××•×‘×™×œ ×‘×™×©×¨××œ. ××ª×” ××™×™×¦×¨ ×¨×¢×™×•× ×•×ª ×ª×•×›×Ÿ ×•×™×¨××œ×™×™×, ×§×¨×™××™×™×˜×™×‘×™×™× ×•××¢×©×™×™× ×©××ª××™××™× ×œ×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª.`;
  const prompt = `×¦×•×¨ ${count} ×¨×¢×™×•× ×•×ª ×ª×•×›×Ÿ ×™×™×—×•×“×™×™× ×œ${platform ? '×¤×œ×˜×¤×•×¨××ª '+platform : '×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª'} ×‘× ×™×©×ª "${niche}".

×›×œ ×¨×¢×™×•×Ÿ ×‘×¤×•×¨××˜ ×”×‘× (×©×•×¨×” ××—×ª):
EMOJI | ×›×•×ª×¨×ª ×”×¨×¢×™×•×Ÿ | ×ª×™××•×¨ ×§×¦×¨ (2 ××©×¤×˜×™×) | ×ª×’×™×ª1,×ª×’×™×ª2,×ª×’×™×ª3

×œ×“×•×’××”:
ğŸ”¥ | ×›×•×ª×¨×ª ××“×œ×™×§×” | ×ª×™××•×¨ ×§×¦×¨ ×©×œ ×”×¨×¢×™×•×Ÿ. ×œ××” ×–×” ×™×¢×‘×•×“. | ×•×™×¨××œ×™,×—×™× ×•×›×™,××•×˜×™×‘×¦×™×”

×™×™×¦×¨ ${count} ×©×•×¨×•×ª ×›××œ×”. ×›×ª×•×‘ ×‘×¢×‘×¨×™×ª. ×”×¨×¢×™×•× ×•×ª ×¦×¨×™×›×™× ×œ×”×™×•×ª ××’×•×•× ×™×, ×§×¨×™××™×™×˜×™×‘×™×™× ×•×‘×¢×œ×™ ×¤×•×˜× ×¦×™××œ ×•×™×¨××œ×™.`;

  try {
    const text = await callClaude(prompt, sys, 2000);
    const parsed = parseAIIdeas(text);
    renderAIIdeasResult(parsed);
    ss('niche', niche);
  } catch(e) {
    document.getElementById('aiIdeasResult').innerHTML = errorHTML(e.message);
  } finally {
    btn.disabled=false; btn.textContent='âœ¨ ×¦×•×¨ ×¨×¢×™×•× ×•×ª';
  }
}

function parseAIIdeas(text) {
  const lines = text.split('\n').filter(l=>l.includes('|'));
  return lines.map(l=>{
    const parts = l.split('|').map(p=>p.trim());
    return { emoji:parts[0]||'ğŸ’¡', title:parts[1]||'', body:parts[2]||'', tags:(parts[3]||'').split(',').map(t=>t.trim()).filter(Boolean) };
  }).filter(i=>i.title);
}

function renderAIIdeasResult(items) {
  if (!items.length) { document.getElementById('aiIdeasResult').innerHTML = errorHTML('×œ× ×”×¦×œ×—×ª×™ ×œ×¤×¨×¡×¨ ××ª ×”×ª×©×•×‘×” â€” × ×¡×” ×©×•×‘'); return; }
  document.getElementById('aiIdeasResult').innerHTML = `
    <div style="margin-top:20px;margin-bottom:12px;font-size:13px;color:var(--text-muted);font-weight:600;">âœ¨ ${items.length} ×¨×¢×™×•× ×•×ª × ×•×¦×¨×• â€” ×‘×—×¨ ××” ×œ×©××•×¨:</div>
    <div style="display:flex;flex-direction:column;gap:8px;max-height:340px;overflow-y:auto;">
      ${items.map((item,i)=>`
        <div style="background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:12px 14px;display:flex;align-items:flex-start;gap:12px;">
          <span style="font-size:20px;flex-shrink:0;">${item.emoji}</span>
          <div style="flex:1;min-width:0;">
            <div style="font-size:14px;font-weight:700;margin-bottom:4px;">${item.title}</div>
            <div style="font-size:12px;color:var(--text-muted);line-height:1.5;">${item.body}</div>
            ${item.tags.length?`<div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:4px;">${item.tags.map(t=>`<span class="idea-tag">#${t}</span>`).join('')}</div>`:''}
          </div>
          <button class="btn btn-primary" style="padding:5px 12px;font-size:12px;flex-shrink:0;" onclick="saveAIIdea(${i})">+ ×©××•×¨</button>
        </div>
      `).join('')}
    </div>
  `;
  window._aiIdeasBuffer = items;
}

function saveAIIdea(idx) {
  const item = window._aiIdeasBuffer?.[idx];
  if (!item) return;
  ideas.push({ id:uid(), title:item.title, emoji:item.emoji, body:item.body, tags:item.tags });
  save();
  renderIdeas();
  notify('×¨×¢×™×•×Ÿ × ×©××¨! ğŸ’¡','ğŸ’¡');
  // Grey out the button
  const btns = document.querySelectorAll('#aiIdeasResult button');
  if (btns[idx]) { btns[idx].textContent='âœ“'; btns[idx].disabled=true; btns[idx].style.background='var(--accent4)'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CREATOR INSPIRATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function searchCreator() {
  const name = document.getElementById('creatorInput').value.trim();
  if (!name) return;
  const btn = document.getElementById('creatorBtn');
  btn.disabled=true; btn.textContent='â³ ××—×¤×©...';
  document.getElementById('creatorResults').innerHTML = loadingHTML('×× ×ª×— ××ª ×”×¡×’× ×•×Ÿ ×©×œ '+name+'...');

  try {
    let videosContext = '';
    const ytKey = gs('yt_key');
    if (ytKey) {
      try {
        const ytData = await fetchYouTubeVideos(name, ytKey);
        if (ytData?.length) {
          videosContext = `\n\n×¡×¨×˜×•× ×™× ×××™×ª×™×™× ×©×œ×”×:\n${ytData.slice(0,8).map((t,i)=>`${i+1}. ${t}`).join('\n')}`;
        }
      } catch(e) { /* fallback to knowledge */ }
    }

    const niche = gs('niche') || '×ª×•×›×Ÿ ×›×œ×œ×™';
    const sys = `××ª×” ××¡×˜×¨×˜×’ ×ª×•×›×Ÿ ××•×‘×™×œ. ××ª×” ××›×™×¨ ××ª ×›×œ ×™×•×¦×¨×™ ×”×ª×•×›×Ÿ ×”×’×“×•×œ×™× ×‘×¢×•×œ× ×•×‘×™×©×¨××œ.`;
    const prompt = `×™×•×¦×¨ ×”×ª×•×›×Ÿ ×©××—×¤×©×™×: "${name}"${videosContext}

×¢×œ ×‘×¡×™×¡ ×”×¡×’× ×•×Ÿ, ×”× ×•×©××™× ×•×”×§×”×œ ×©×œ ${name}, ×¦×•×¨ 6 ×¨×¢×™×•× ×•×ª ×ª×•×›×Ÿ ××§×•×¨×™×™× ×©××ª××™××™× ×œ×™×•×¦×¨ ×©×¢×•×‘×“ ×‘× ×™×©×ª "${niche}".

×”×¨×¢×™×•× ×•×ª ×¦×¨×™×›×™× ×œ×”×™×•×ª ×‘×”×©×¨××ª ×”×¡×’× ×•×Ÿ ×©×œ ${name} ××š ××§×•×¨×™×™× ×œ×—×œ×•×˜×™×Ÿ.

×¤×•×¨××˜ (×©×•×¨×” ××—×ª ×œ×¨×¢×™×•×Ÿ):
EMOJI | ×›×•×ª×¨×ª | ×ª×™××•×¨ ×§×¦×¨ | ×ª×’×™×ª1,×ª×’×™×ª2

×›×ª×•×‘ ×‘×¢×‘×¨×™×ª.`;

    const text = await callClaude(prompt, sys, 1500);
    const items = parseAIIdeas(text);
    renderCreatorResults(items, name);
  } catch(e) {
    document.getElementById('creatorResults').innerHTML = errorHTML(e.message);
  } finally {
    btn.disabled=false; btn.textContent='ğŸ” ×—×¤×© ×•×¦×•×¨ ×¨×¢×™×•× ×•×ª';
  }
}

async function fetchYouTubeVideos(query, apiKey) {
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=8&key=${apiKey}`;
  const resp = await fetch(url);
  if (!resp.ok) return null;
  const data = await resp.json();
  return data.items?.map(i=>i.snippet.title)||[];
}

function renderCreatorResults(items, creatorName) {
  if (!items.length) { document.getElementById('creatorResults').innerHTML = errorHTML('×œ× × ××¦××• ×ª×•×¦××•×ª'); return; }
  document.getElementById('creatorResults').innerHTML = `
    <div style="grid-column:1/-1;font-size:13px;color:var(--text-muted);font-weight:600;margin-bottom:4px;">ğŸ’¡ ${items.length} ×¨×¢×™×•× ×•×ª ×‘×”×©×¨××ª ${creatorName}</div>
    ${items.map((item,i)=>`
      <div class="idea-card" style="padding:14px;" onclick="void(0)">
        <div class="idea-emoji" style="font-size:22px;margin-bottom:8px;">${item.emoji}</div>
        <div class="idea-title" style="font-size:14px;">${item.title}</div>
        <div class="idea-body" style="font-size:12px;">${item.body}</div>
        <div class="idea-tags">${(item.tags||[]).map(t=>`<span class="idea-tag">#${t}</span>`).join('')}</div>
        <button class="btn btn-primary" style="width:100%;margin-top:12px;padding:6px;font-size:12px;" onclick="saveCreatorIdea(${i},'${creatorName.replace(/'/g,"\\'")}')">+ ×©××•×¨ ×œ×¨×¢×™×•× ×•×ª</button>
      </div>
    `).join('')}
  `;
  window._creatorIdeasBuffer = items;
}

function saveCreatorIdea(idx, creator) {
  const item = window._creatorIdeasBuffer?.[idx];
  if (!item) return;
  ideas.push({ id:uid(), title:item.title, emoji:item.emoji, body:`×‘×”×©×¨××ª ${creator}: ${item.body}`, tags:[...item.tags, '×‘×”×©×¨××ª-'+creator.replace(/\s/g,'-')] });
  save();
  renderIdeas();
  notify('×¨×¢×™×•×Ÿ × ×©××¨! ğŸ’¡','ğŸ’¡');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ğŸª„ SCRIPT GENERATION â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openScriptModal(e, id) {
  e && e.stopPropagation();
  const c = contents.find(x=>x.id===id);
  if (!c) return;

  const p = PLATFORMS[c.platform] || PLATFORMS.instagram;
  document.getElementById('scriptTitle').textContent = `ğŸª„ ${c.title}`;
  document.getElementById('scriptPlatformBadge').innerHTML = `
    <span class="script-platform-badge" style="background:${p.bg};color:${p.color};border:1px solid ${p.border};">
      ${p.icon} ${p.label}
    </span>`;
  document.getElementById('copyScriptBtn').style.display='none';
  document.getElementById('scriptContent').innerHTML = loadingHTML('×›×•×ª×‘ ×¡×§×¨×™×¤×˜ ××•×ª×× ×œ-'+p.label+'...');
  document.getElementById('scriptModal').classList.add('open');
  generatedScript = '';

  try {
    const script = await generateScript(c);
    generatedScript = script;
    document.getElementById('scriptContent').innerHTML = renderScriptHTML(script, c.platform);
    document.getElementById('copyScriptBtn').style.display='flex';
  } catch(e) {
    document.getElementById('scriptContent').innerHTML = errorHTML(e.message);
  }
}

function closeScriptModal() { document.getElementById('scriptModal').classList.remove('open'); }

async function generateScript(c) {
  const sys = `××ª×” ×›×•×ª×‘ ×ª×¡×¨×™×˜×™× ××§×¦×•×¢×™ ×œ×ª×•×›×Ÿ ×‘×¨×©×ª×•×ª ×”×—×‘×¨×ª×™×•×ª. ××ª×” ×›×•×ª×‘ ×‘×¢×‘×¨×™×ª, ×‘×¡×’× ×•×Ÿ ×©×•×‘×” ×œ×‘, ×××•×§×“, ×•××•×ª×× ×œ×¤×œ×˜×¤×•×¨××”.`;
  const platform = c.platform;
  const title = c.title;
  const desc = c.desc || '';

  let prompt;
  if (platform==='youtube') {
    prompt = `×›×ª×•×‘ ×¡×§×¨×™×¤×˜ ××œ× ×œ×¡×¨×˜×•×Ÿ YouTube ×‘××•×¨×š ~10 ×“×§×•×ª.
×›×•×ª×¨×ª: ${title}
×ª×™××•×¨: ${desc}

×¤×•×¨××˜:
ğŸ¬ HOOK (0-30 ×©× ×™×•×ª):
[×˜×§×¡×˜ ×”-hook]

ğŸ“ INTRO (30 ×©× ×™×•×ª-1 ×“×§×”):
[××‘×•× + ××” ×”×¦×•×¤×” ×™×œ××“]

ğŸ“š ×¤×¨×§ 1 - [×©×] (×“×§×•×ª 1-3):
[×ª×•×›×Ÿ]

ğŸ“š ×¤×¨×§ 2 - [×©×] (×“×§×•×ª 3-5):
[×ª×•×›×Ÿ]

ğŸ“š ×¤×¨×§ 3 - [×©×] (×“×§×•×ª 5-7):
[×ª×•×›×Ÿ]

ğŸ“š ×¤×¨×§ 4 - [×©×] (×“×§×•×ª 7-9):
[×ª×•×›×Ÿ]

ğŸ¯ OUTRO (×“×§×•×ª 9-10):
[×¡×™×›×•× + call to action + subscribe]

×›×ª×•×‘ ×‘×¢×‘×¨×™×ª. ×›×œ ×¤×¨×§ ×¦×¨×™×š ×œ×”×™×•×ª ××¤×•×¨×˜ ×•××œ×.`;
  } else if (platform==='linkedin') {
    prompt = `×›×ª×•×‘ ×¤×•×¡×˜ ××§×¦×•×¢×™ ×œ-LinkedIn.
× ×•×©×: ${title}
×ª×™××•×¨: ${desc}

×¤×•×¨××˜:
ğŸª HOOK (×©×•×¨×” ×¨××©×•× ×” - ×—×™×™×‘×ª ×œ×‘×œ×•×˜):
[hook ×—×–×§]

ğŸ’¡ BODY:
[×ª×•×›×Ÿ ×”×¤×•×¡×˜ - 150-250 ××™×œ×™×, ×¢× ×¨×•×•×—×™× ×‘×™×Ÿ ×¤×¡×§××•×ª, bullets ×× ×¦×¨×™×š]

ğŸ¯ CTA:
[call to action]

#HASHTAGS:
[5-8 hashtags ×¨×œ×•×•× ×˜×™×™×]

×›×ª×•×‘ ×‘×¢×‘×¨×™×ª. ×¡×’× ×•×Ÿ ××§×¦×•×¢×™ ××š ×× ×•×©×™.`;
  } else if (platform==='twitter') {
    prompt = `×›×ª×•×‘ thread ×œ-Twitter/X.
× ×•×©×: ${title}
×ª×™××•×¨: ${desc}

×¤×•×¨××˜ - Thread ×©×œ 6-8 ×¦×™×•×¦×™×:
ğŸ§µ ×¦×™×•×¥ 1 (hook):
[280 ×ª×•×•×™× ××§×¡×™××•×]

2/ ×¦×™×•×¥ 2:
[×ª×•×›×Ÿ]

3/ ×¦×™×•×¥ 3:
[×ª×•×›×Ÿ]

[×”××©×š ×¢×“ 6-8 ×¦×™×•×¦×™×]

ğŸ¯ ×¦×™×•×¥ ××—×¨×•×Ÿ (CTA):
[RT/Follow/reply]

×›×ª×•×‘ ×‘×¢×‘×¨×™×ª.`;
  } else {
    // Instagram/TikTok - Reels script
    const platName = platform==='instagram' ? 'Instagram Reels' : 'TikTok';
    prompt = `×›×ª×•×‘ ×¡×§×¨×™×¤×˜ ××œ× ×œ-${platName} â€” ×¡×¨×˜×•×Ÿ ×•×¨×˜×™×§×œ×™ ×‘××•×¨×š 40-60 ×©× ×™×•×ª.
×›×•×ª×¨×ª: ${title}
×ª×™××•×¨: ${desc}

×¤×•×¨××˜:
ğŸ¬ HOOK (×©× ×™×•×ª 0-3) - ×—×™×™×‘ ×œ×¢×¦×•×¨ ×’×œ×™×œ×”:
[×˜×§×¡×˜ ×”-hook â€” ××” ××•××¨×™×/×¢×•×©×™× ×‘-3 ×©× ×™×•×ª ×”×¨××©×•× ×•×ª]

ğŸ“ INTRO (×©× ×™×•×ª 3-8):
[×”×¦×’×” ×§×¦×¨×” ×××•×“]

ğŸ’¡ CONTENT (×©× ×™×•×ª 8-50):
[×”×ª×•×›×Ÿ ×”×¢×™×§×¨×™ â€” ×©×œ×•×© × ×§×•×“×•×ª ×¢×™×§×¨×™×•×ª, ×›×œ ××—×ª 10-15 ×©× ×™×•×ª]

ğŸ¯ CTA (×©× ×™×•×ª 50-60):
[call to action â€” follow/share/comment]

ğŸ“ CAPTION ×œ×¤×•×¡×˜:
[×›×™×ª×•×‘ ××œ× ×œ×¤×•×¡×˜ ×›×•×œ×œ emojis ×•-hashtags]

×›×ª×•×‘ ×‘×¢×‘×¨×™×ª. ×”×¡×§×¨×™×¤×˜ ×¦×¨×™×š ×œ×”×™×•×ª ×§×¦×‘ ×’×‘×•×” ×•××¨×ª×§.`;
  }

  return await callClaude(prompt, sys, 2500);
}

function renderScriptHTML(text, platform) {
  // Parse sections from the script
  const sectionEmojis = { 'ğŸ¬':'hook', 'ğŸ“':'intro', 'ğŸ“š':'section', 'ğŸ’¡':'content', 'ğŸ¯':'cta', 'ğŸ“':'caption', 'ğŸ§µ':'tweet', '#':'hashtags' };

  // Split by numbered sections or emoji headers
  const lines = text.split('\n');
  let sections = [];
  let current = null;

  lines.forEach(line => {
    const trimmed = line.trim();
    if (!trimmed) { if(current) current.content += '\n'; return; }

    // Check if it's a section header (starts with emoji or is all-caps heading)
    const firstChar = trimmed[0];
    const isHeader = Object.keys(sectionEmojis).some(e=>trimmed.startsWith(e)) ||
      (trimmed.endsWith(':') && trimmed.length < 60 && !trimmed.includes('['));

    if (isHeader && trimmed.includes(':')) {
      if (current && current.content.trim()) sections.push(current);
      current = { label: trimmed.replace(':','').trim(), content:'' };
    } else {
      if (!current) current = { label:'', content:'' };
      current.content += (current.content ? '\n' : '') + line;
    }
  });
  if (current && current.content.trim()) sections.push(current);

  if (!sections.length) {
    return `<div class="script-body"><div class="script-section"><div class="script-section-content">${text}</div></div></div>`;
  }

  return `<div class="script-body">
    ${sections.map(s=>`
      <div class="script-section">
        ${s.label?`<div class="script-section-label">${s.label}</div>`:''}
        <div class="script-section-content">${s.content.trim().replace(/\n/g,'<br>')}</div>
      </div>
    `).join('')}
  </div>`;
}

function copyScript() {
  if (!generatedScript) return;
  navigator.clipboard.writeText(generatedScript).then(()=>notify('×”×¡×§×¨×™×¤×˜ ×”×•×¢×ª×§ âœ“','ğŸ“‹'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let notifTimer = null;

function initNotifications() {
  clearTimeout(notifTimer);
  if (gs('browser_notif')!=='1') return;

  const now = new Date();
  const target = new Date(now);
  target.setHours(9,0,0,0);

  const lastSent = gs('notif_last_sent');
  const today = now.toDateString();

  // If it's past 9AM and haven't sent today
  if (now >= target && lastSent !== today) {
    sendDailyReminder();
    return;
  }

  // Schedule for next 9AM
  const nextTarget = now >= target ? new Date(target.getTime() + 86400000) : target;
  const delay = nextTarget - now;
  notifTimer = setTimeout(()=>{ sendDailyReminder(); initNotifications(); }, delay);
}

async function sendDailyReminder() {
  const today = new Date().toDateString();
  ss('notif_last_sent', today);

  const msg = buildReminderMessage();

  // Browser notification
  if (Notification.permission==='granted' && gs('browser_notif')==='1') {
    new Notification('Content Studio âœ¦ â€” ×‘×•×§×¨ ×˜×•×‘!', { body: msg, icon:'https://avivmalka123.github.io/content-studio/favicon.ico' });
  }

  // ntfy.sh
  const ntfyTopic = gs('ntfy_topic');
  if (ntfyTopic) {
    fetch(`https://ntfy.sh/${ntfyTopic}`, {
      method:'POST',
      headers:{ 'Title':'Content Studio âœ¦ â€” ×‘×•×§×¨ ×˜×•×‘!', 'Tags':'spiral_notepad,calendar', 'Priority':'high' },
      body: msg
    }).catch(()=>{});
  }

  // WhatsApp CallMeBot
  const phone = gs('wb_phone');
  const wbKey = gs('wb_key');
  if (phone && wbKey) {
    const encoded = encodeURIComponent(msg);
    fetch(`https://api.callmebot.com/whatsapp.php?phone=${phone}&text=${encoded}&apikey=${wbKey}`).catch(()=>{});
  }
}

function buildReminderMessage() {
  const todayStr = new Date().toISOString().slice(0,10);
  const toPublish = contents.filter(c=>c.end===todayStr);
  const inProd    = contents.filter(c=>c.status==='production');
  const ready     = contents.filter(c=>c.status==='ready');

  let msg = 'â˜€ï¸ Content Studio â€” ×‘×•×§×¨ ×˜×•×‘!\n\n';
  if (toPublish.length) msg += `ğŸ“… ×œ×¤×¨×¡×•× ×”×™×•× (${toPublish.length}):\n${toPublish.map(c=>`â€¢ ${c.title}`).join('\n')}\n\n`;
  if (inProd.length)    msg += `ğŸ¬ ×‘×™×™×¦×•×¨ (${inProd.length}):\n${inProd.slice(0,3).map(c=>`â€¢ ${c.title}`).join('\n')}\n\n`;
  if (ready.length)     msg += `âœ… ××•×›×Ÿ ×œ×¤×¨×¡×•× (${ready.length}):\n${ready.slice(0,3).map(c=>`â€¢ ${c.title}`).join('\n')}\n\n`;
  if (!toPublish.length && !inProd.length && !ready.length) msg += '××™×Ÿ ×¤×¨×™×˜×™× ××ª×•×–×× ×™× ×œ×”×™×•× â€” ×¦×•×¨ ×ª×•×›×Ÿ ×—×“×©! ğŸš€';
  return msg.trim();
}

async function testNotifications() {
  notify('×©×•×œ×— ×”×•×“×¢×ª ×‘×“×™×§×”...','â³');
  const origDate = gs('notif_last_sent');
  ss('notif_last_sent',''); // reset so it sends
  await sendDailyReminder();
  ss('notif_last_sent', origDate); // restore
  setTimeout(()=>notify('×”×•×“×¢×ª ×‘×“×™×§×” × ×©×œ×—×” âœ“','âœ…'),500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadingHTML(text='×˜×•×¢×Ÿ...') {
  return `<div class="loading-wrap"><div class="spinner"></div><div class="loading-text">${text}</div></div>`;
}
function errorHTML(msg) {
  return `<div class="error-box" style="margin-top:16px;">âš ï¸ <span>${msg}</span></div>`;
}
function handleOverlayClick(e, id, fn) { if(e.target===document.getElementById(id)) fn(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', ()=>{
  const d = new Date();
  document.getElementById('currentDate').textContent = d.toLocaleDateString('he-IL',{weekday:'long',day:'numeric',month:'long',year:'numeric'});

  const today = new Date().toISOString().slice(0,10);
  const nextWeek = new Date(Date.now()+7*86400000).toISOString().slice(0,10);
  document.getElementById('f-start').value = today;
  document.getElementById('f-end').value   = nextWeek;

  if (contents.length===0) seedData();

  // Show API key hint if not set
  if (!gs('claude_key')) {
    document.getElementById('notifBadge').classList.add('show');
  }

  initNotifications();
  renderAll();

  document.addEventListener('click', e=>{
    if (!e.target.closest('#ctxMenu') && !e.target.closest('.card-menu-btn'))
      document.getElementById('ctxMenu').classList.remove('open');
  });

  document.addEventListener('keydown', e=>{
    if (e.key==='Escape') { closeModal(); closeIdeaModal(); closeScriptModal(); closeSettings(); closeAIIdeasModal(); document.getElementById('ctxMenu').classList.remove('open'); }
    if ((e.metaKey||e.ctrlKey) && e.key==='n') { e.preventDefault(); openModal(); }
  });
});

function seedData() {
  const d = (off,extra=7)=>{
    const s=new Date(); s.setDate(s.getDate()+off);
    const e=new Date(); e.setDate(e.getDate()+off+extra);
    return [s.toISOString().slice(0,10), e.toISOString().slice(0,10)];
  };
  contents = [
    {id:uid(),title:'×¡×¨×˜×•×Ÿ "5 ×˜×™×¤×™× ×œ×‘×•×§×¨ ×× ×¦×—"',  platform:'youtube',   status:'idea',       start:d(-5)[0], end:d(-5,14)[1],desc:'×ª×•×›×Ÿ ×—×™× ×•×›×™ ×¢×œ ×©×’×¨×ª ×‘×•×§×¨'},
    {id:uid(),title:'×¨×™×œ â€” ××—×¨×™ ×©× ×” ×©×œ ×™×¦×™×¨×”',      platform:'instagram', status:'production', start:d(-3)[0], end:d(-3,5)[1], desc:'×¡×™×¤×•×¨ ××™×©×™ ×¢×œ ×”×“×¨×š'},
    {id:uid(),title:'TikTok ×˜×¨× ×“ â€” Challenge',       platform:'tiktok',    status:'ready',      start:d(0)[0],  end:d(0,3)[1],  desc:'×¨×™×œ ××”×™×¨ 15 ×©× ×™×•×ª'},
    {id:uid(),title:'Thread â€” ××™×š ×‘× ×™× ×• 10K ×¢×•×§×‘×™×',platform:'twitter',   status:'published',  start:d(-10)[0],end:d(-10,1)[1],desc:'×¤×•×¡×˜ ×•×™×¨××œ×™'},
    {id:uid(),title:'×¤×•×¡×˜ LinkedIn â€” ×¡×™×¤×•×¨ ×”×§×¨×™×™×¨×”',platform:'linkedin',  status:'idea',       start:d(3)[0],  end:d(3,7)[1],  desc:'×ª×•×›×Ÿ ××§×¦×•×¢×™'},
    {id:uid(),title:'YouTube â€” ×××—×•×¨×™ ×”×§×œ×¢×™×',       platform:'youtube',   status:'production', start:d(1)[0],  end:d(1,10)[1], desc:'vlog ×©×‘×•×¢×™'},
  ];
  ideas = [
    {id:uid(),title:'×¡×“×¨×ª "×™×•× ×‘×—×™×™×"',   emoji:'ğŸ“¹',body:'×¡×“×¨×” ×©×‘×•×¢×™×ª ×©××¨××” ××ª ×”×™×•× ×©×œ×™ ×›×™×•×¦×¨ ×ª×•×›×Ÿ',tags:['×•×™×¨××œ×™','×¡×“×¨×”','××•×ª× ×˜×™']},
    {id:uid(),title:'××ª×’×¨ 30 ×™××™×',        emoji:'ğŸ”¥',body:'×œ×¦×œ× ×•×œ×¤×¨×¡× ×ª×•×›×Ÿ ×›×œ ×™×•× ×‘××©×š ×—×•×“×© ×•×œ×ª×¢×“ ×¦××™×—×”',tags:['××ª×’×¨','×¦××™×—×”']},
    {id:uid(),title:'×§×•×œ××‘ ×¢× ×™×•×¦×¨×™×',    emoji:'ğŸ¤',body:'×œ×–×”×•×ª 5 ×™×•×¦×¨×™× ×‘× ×™×©×” ×•×œ×”×¦×™×¢ ×©×™×ª×•×£ ×¤×¢×•×œ×”',tags:['×§×•×œ××‘','× ×˜×•×•×¨×§×™× ×’']},
  ];
  save();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER ALL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll() { updateStats(); renderBoard(); renderGantt(); renderIdeas(); renderAnalytics(); }

function updateStats() {
  const c={idea:0,production:0,ready:0,published:0};
  contents.forEach(x=>{if(c[x.status]!==undefined)c[x.status]++;});
  document.getElementById('stat-idea').textContent       = c.idea;
  document.getElementById('stat-production').textContent = c.production;
  document.getElementById('stat-ready').textContent      = c.ready;
  document.getElementById('stat-published').textContent  = c.published;
  document.getElementById('stat-total').textContent      = contents.length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function filterByStatus(s) { statusFilter = statusFilter===s ? null : s; renderBoard(); }

function renderBoard() {
  const pf = document.getElementById('platformFilter').value;
  const filtered = contents.filter(c=>(!pf||c.platform===pf)&&(!statusFilter||c.status===statusFilter));
  const cols = {
    idea:       {items:[],label:'ğŸ’¡ ×¨×¢×™×•×Ÿ',  color:'#f59e0b'},
    production: {items:[],label:'ğŸ¬ ×‘×™×™×¦×•×¨', color:'#06b6d4'},
    ready:      {items:[],label:'âœ… ××•×›×Ÿ',   color:'#10b981'},
    published:  {items:[],label:'ğŸš€ ×¤×•×¨×¡×',  color:'#a855f7'},
  };
  filtered.forEach(c=>{if(cols[c.status])cols[c.status].items.push(c);});
  document.getElementById('kanban-board').innerHTML = Object.entries(cols).map(([key,col])=>`
    <div class="kanban-col">
      <div class="kanban-col-header">
        <div class="col-title-wrap">
          <div class="col-dot" style="background:${col.color};box-shadow:0 0 8px ${col.color}66;"></div>
          <div class="col-title">${col.label}</div>
        </div>
        <div class="col-count">${col.items.length}</div>
      </div>
      <div class="kanban-cards">
        ${col.items.length===0
          ? '<div class="empty-state"><div class="empty-icon">â—‹</div><p>××™×Ÿ ×ª×•×›×Ÿ ×›××Ÿ ×¢×“×™×™×Ÿ</p></div>'
          : col.items.map(renderCard).join('')}
      </div>
    </div>
  `).join('');
}

function renderCard(item) {
  const p = PLATFORMS[item.platform]||PLATFORMS.instagram;
  return `
    <div class="content-card" onclick="openEditModal('${item.id}')">
      <div style="position:absolute;top:0;right:0;width:3px;height:100%;background:${p.color};border-radius:0 14px 14px 0;opacity:0.7;"></div>
      <div class="card-top">
        <div class="card-title">${item.title}</div>
        <button class="card-menu-btn" onclick="openCtxMenu(event,'${item.id}')">â‹¯</button>
      </div>
      <div class="card-meta">
        <span class="platform-tag" style="background:${p.bg};border-color:${p.border};color:${p.color};">${p.icon} ${p.label}</span>
        ${item.end?`<span class="date-tag">ğŸ“… ${formatDate(item.end)}</span>`:''}
      </div>
      ${item.desc?`<div class="card-desc">${item.desc.slice(0,80)}${item.desc.length>80?'...':''}</div>`:''}
      <div class="card-actions">
        <button class="card-action-btn" onclick="advanceStatus(event,'${item.id}')">â­ ×§×“×</button>
        <button class="card-action-btn" onclick="openEditModal('${item.id}');event.stopPropagation()">âœï¸ ×¢×¨×•×š</button>
        <button class="card-action-btn wand" onclick="openScriptModal(event,'${item.id}')">ğŸª„ ×¡×§×¨×™×¤×˜</button>
      </div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GANTT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shiftGantt(dir) { ganttOffset = dir===0 ? 0 : ganttOffset+dir; renderGantt(); }

function renderGantt() {
  const today = new Date();
  const base  = new Date(today.getFullYear(), today.getMonth()+ganttOffset, 1);
  const days  = [];
  for (let m=0;m<2;m++) {
    const ms = new Date(base.getFullYear(), base.getMonth()+m, 1);
    const dm = new Date(ms.getFullYear(), ms.getMonth()+1, 0).getDate();
    for (let d=1;d<=dm;d++) days.push(new Date(ms.getFullYear(), ms.getMonth(), d));
  }
  const gStart=days[0], gEnd=days[days.length-1];
  const months=[]; let cur=null;
  days.forEach(d=>{
    const key=`${d.getFullYear()}-${d.getMonth()}`;
    if(!cur||cur.key!==key){cur={key,label:d.toLocaleDateString('he-IL',{month:'long',year:'numeric'}),days:[]};months.push(cur);}
    cur.days.push(d);
  });
  const W=36, TW=220;
  const isToday=d=>d.toDateString()===today.toDateString();
  const isWE=d=>d.getDay()===5||d.getDay()===6;
  const todayIdx=days.findIndex(d=>isToday(d));
  const todayPx=todayIdx>=0?todayIdx*W+W/2:-1;
  const relevant=contents.filter(c=>{
    if(!c.start&&!c.end) return false;
    const s=c.start?new Date(c.start+'T12:00:00'):null;
    const e=c.end?new Date(c.end+'T12:00:00'):s;
    return (e>=gStart&&s<=gEnd);
  });
  let html=`<div style="display:flex;flex-direction:column;">`;
  // Header
  html+=`<div style="display:flex;position:sticky;top:0;z-index:10;background:var(--surface2);">
    <div style="width:${TW}px;flex-shrink:0;padding:12px 16px;border-left:1px solid var(--border);border-bottom:1px solid var(--border);font-size:12px;font-weight:700;color:var(--text-muted);display:flex;align-items:center;">×ª×•×›×Ÿ</div>
    <div style="display:flex;flex:1;overflow:hidden;">`;
  months.forEach(m=>{
    html+=`<div style="flex-shrink:0;width:${m.days.length*W}px;border-left:1px solid var(--border);">
      <div style="padding:8px 12px;font-size:12px;font-weight:700;color:var(--text-muted);border-bottom:1px solid var(--border);text-align:center;">${m.label}</div>
      <div style="display:flex;">`;
    m.days.forEach(d=>{html+=`<div style="width:${W}px;flex-shrink:0;padding:6px 2px;text-align:center;font-size:11px;font-weight:${isToday(d)?'800':'500'};color:${isToday(d)?'var(--neon)':isWE(d)?'rgba(107,107,138,0.4)':'var(--text-muted)'};background:${isToday(d)?'rgba(124,58,237,0.15)':''};">${d.getDate()}</div>`;});
    html+=`</div></div>`;
  });
  html+=`</div></div>`;
  // Rows
  if (!relevant.length) {
    html+=`<div style="padding:40px;text-align:center;color:var(--text-muted);">××™×Ÿ ×ª×•×›×Ÿ ×‘×˜×•×•×— ×–××Ÿ ×–×”. ×”×•×¡×£ ×ª×•×›×Ÿ ×¢× ×ª××¨×™×›×™×!</div>`;
  } else {
    relevant.forEach(c=>{
      const p=PLATFORMS[c.platform]||PLATFORMS.instagram;
      const st=STATUSES[c.status]||STATUSES.idea;
      const sD=c.start?new Date(c.start+'T12:00:00'):new Date(c.end+'T12:00:00');
      const eD=c.end?new Date(c.end+'T12:00:00'):sD;
      const cs=new Date(Math.max(sD,gStart)); const ce=new Date(Math.min(eD,gEnd));
      const si=days.findIndex(d=>d.toDateString()===cs.toDateString());
      const ei=days.findIndex(d=>d.toDateString()===ce.toDateString());
      const bl=(si>=0?si:0)*W; const bw=((ei>=0?ei:days.length-1)-(si>=0?si:0)+1)*W-4;
      html+=`<div style="display:flex;border-bottom:1px solid var(--border);align-items:center;min-height:52px;" onmouseenter="this.style.background='rgba(255,255,255,0.02)'" onmouseleave="this.style.background=''">
        <div style="width:${TW}px;flex-shrink:0;padding:10px 16px;border-left:1px solid var(--border);display:flex;align-items:center;gap:8px;cursor:pointer;" onclick="openEditModal('${c.id}')">
          <div style="width:8px;height:8px;border-radius:50%;background:${p.color};flex-shrink:0;"></div>
          <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${c.title}</div>
        </div>
        <div style="flex:1;position:relative;height:52px;display:flex;align-items:center;">
          <div style="display:flex;position:absolute;top:0;left:0;right:0;bottom:0;">`;
      days.forEach(d=>{html+=`<div style="width:${W}px;flex-shrink:0;border-left:1px solid rgba(255,255,255,0.03);background:${isToday(d)?'rgba(124,58,237,0.06)':isWE(d)?'rgba(0,0,0,0.08)':'transparent'};"></div>`;});
      html+=`</div>`;
      if(todayPx>=0) html+=`<div style="position:absolute;top:0;bottom:0;left:${todayPx}px;width:2px;background:linear-gradient(to bottom,var(--neon),transparent);z-index:5;pointer-events:none;"></div>`;
      if(bw>0) html+=`<div onclick="openEditModal('${c.id}')" style="position:absolute;left:${bl+2}px;width:${Math.max(bw,24)}px;height:30px;border-radius:8px;background:${st.ganttColor};display:flex;align-items:center;padding:0 8px;font-size:11px;font-weight:700;color:white;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;z-index:2;box-shadow:0 2px 10px rgba(0,0,0,0.3);transition:filter 0.2s;" onmouseenter="this.style.filter='brightness(1.15)'" onmouseleave="this.style.filter=''">${bw>60?p.icon+' '+c.title:bw>24?p.icon:''}</div>`;
      html+=`</div></div>`;
    });
  }
  html+=`</div>`;
  document.getElementById('gantt-container').innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• IDEAS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderIdeas() {
  const grid = document.getElementById('ideas-grid');
  if (!ideas.length) { grid.innerHTML=`<div style="grid-column:1/-1;"><div class="empty-state"><div class="empty-icon">ğŸ’¡</div><p>××™×Ÿ ×¨×¢×™×•× ×•×ª ×¢×“×™×™×Ÿ â€” ×œ×—×¥ ×¢×œ "×¦×•×¨ ×¨×¢×™×•× ×•×ª ×¢× AI" ğŸš€</p></div></div>`; return; }
  grid.innerHTML = ideas.map(idea=>`
    <div class="idea-card">
      <div style="position:absolute;top:14px;left:14px;display:flex;gap:6px;">
        <button onclick="editIdea('${idea.id}')" class="btn btn-ghost" style="padding:4px 8px;font-size:11px;">âœï¸</button>
        <button onclick="deleteIdea(event,'${idea.id}')" class="btn btn-ghost" style="padding:4px 8px;font-size:11px;color:var(--red);">âœ•</button>
      </div>
      <div onclick="convertIdeaToContent('${idea.id}')" style="cursor:pointer;">
        <div class="idea-emoji">${idea.emoji||'ğŸ’¡'}</div>
        <div class="idea-title">${idea.title}</div>
        <div class="idea-body">${idea.body||''}</div>
        <div class="idea-tags">${(idea.tags||[]).map(t=>`<span class="idea-tag">#${t}</span>`).join('')}</div>
      </div>
      <button onclick="convertIdeaToContent('${idea.id}')" class="btn btn-primary" style="width:100%;margin-top:14px;padding:7px;font-size:12px;">+ ×”×•×¡×£ ×œ×œ×•×— ×ª×•×›×Ÿ</button>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ANALYTICS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAnalytics() {
  const byP={}, byS={}, byM={};
  contents.forEach(c=>{
    byP[c.platform]=(byP[c.platform]||0)+1;
    byS[c.status]=(byS[c.status]||0)+1;
    if(c.end){const m=c.end.slice(0,7);byM[m]=(byM[m]||0)+1;}
  });
  const maxP=Math.max(...Object.values(byP),1);
  const maxS=Math.max(...Object.values(byS),1);
  const sm=Object.keys(byM).sort().slice(-6);
  const maxM=Math.max(...sm.map(m=>byM[m]),1);
  document.getElementById('analytics-grid').innerHTML=`
    <div class="analytics-card">
      <div class="analytics-title">ğŸ“± ×œ×¤×™ ×¤×œ×˜×¤×•×¨××”</div>
      <div class="bar-chart">
        ${Object.entries(byP).map(([p,v])=>{const pl=PLATFORMS[p]||{label:p,color:'#888',icon:''};return`
          <div class="bar-item">
            <div class="bar-label-row"><span class="bar-label">${pl.icon} ${pl.label}</span><span class="bar-val">${v}</span></div>
            <div class="bar-track"><div class="bar-fill" style="width:${(v/maxP)*100}%;background:${pl.color};box-shadow:0 0 8px ${pl.color}66;"></div></div>
          </div>`;}).join('')||'<div style="color:var(--text-muted);font-size:13px;">××™×Ÿ × ×ª×•× ×™×</div>'}
      </div>
    </div>
    <div class="analytics-card">
      <div class="analytics-title">ğŸ¯ ×œ×¤×™ ×¡×˜×˜×•×¡</div>
      <div class="bar-chart">
        ${Object.entries(byS).map(([s,v])=>{const st=STATUSES[s]||{label:s,color:'#888'};return`
          <div class="bar-item">
            <div class="bar-label-row"><span class="bar-label">${st.label}</span><span class="bar-val">${v}</span></div>
            <div class="bar-track"><div class="bar-fill" style="width:${(v/maxS)*100}%;background:${st.color};box-shadow:0 0 8px ${st.color}66;"></div></div>
          </div>`;}).join('')||'<div style="color:var(--text-muted);font-size:13px;">××™×Ÿ × ×ª×•× ×™×</div>'}
      </div>
    </div>
    <div class="analytics-card" style="grid-column:1/-1;">
      <div class="analytics-title">ğŸ“… ×¤×¨×¡×•××™× ×œ×¤×™ ×—×•×“×©</div>
      <div style="display:flex;gap:12px;align-items:flex-end;height:120px;padding-top:20px;">
        ${!sm.length?'<div style="color:var(--text-muted);font-size:13px;">××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ</div>':sm.map(m=>{
          const v=byM[m], h=(v/maxM)*90;
          const label=new Date(m+'-01').toLocaleDateString('he-IL',{month:'short',year:'2-digit'});
          return`<div style="display:flex;flex-direction:column;align-items:center;gap:6px;flex:1;">
            <div style="font-size:12px;font-weight:700;color:var(--text-muted);">${v}</div>
            <div style="width:100%;height:${h}px;background:linear-gradient(to top,var(--accent),var(--accent2));border-radius:6px 6px 0 0;min-height:4px;box-shadow:0 0 10px rgba(124,58,237,0.4);transition:height 0.5s;"></div>
            <div style="font-size:11px;color:var(--text-muted);">${label}</div>
          </div>`;}).join('')}
      </div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTENT MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedPlatform='instagram';
function selectPlatform(el) {
  document.querySelectorAll('.platform-option').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected'); selectedPlatform=el.dataset.platform;
}
function openModal() {
  editingId=null;
  document.getElementById('modalTitle').textContent='×ª×•×›×Ÿ ×—×“×© âœ¦';
  document.getElementById('f-title').value=''; document.getElementById('f-desc').value='';
  document.getElementById('f-status').value='idea'; selectedPlatform='instagram';
  document.querySelectorAll('.platform-option').forEach(o=>o.classList.toggle('selected',o.dataset.platform==='instagram'));
  const t=new Date().toISOString().slice(0,10), nw=new Date(Date.now()+7*86400000).toISOString().slice(0,10);
  document.getElementById('f-start').value=t; document.getElementById('f-end').value=nw;
  document.getElementById('contentModal').classList.add('open');
  setTimeout(()=>document.getElementById('f-title').focus(),100);
}
function openEditModal(id) {
  const c=contents.find(x=>x.id===id); if(!c) return;
  editingId=id;
  document.getElementById('modalTitle').textContent='×¢×¨×•×š ×ª×•×›×Ÿ';
  document.getElementById('f-title').value=c.title; document.getElementById('f-desc').value=c.desc||'';
  document.getElementById('f-status').value=c.status; document.getElementById('f-start').value=c.start||''; document.getElementById('f-end').value=c.end||'';
  selectedPlatform=c.platform;
  document.querySelectorAll('.platform-option').forEach(o=>o.classList.toggle('selected',o.dataset.platform===c.platform));
  document.getElementById('contentModal').classList.add('open');
}
function closeModal() { document.getElementById('contentModal').classList.remove('open'); editingId=null; }
function saveContent() {
  const title=document.getElementById('f-title').value.trim();
  if(!title){document.getElementById('f-title').style.borderColor='var(--red)';return;}
  document.getElementById('f-title').style.borderColor='';
  const data={title,platform:selectedPlatform,status:document.getElementById('f-status').value,start:document.getElementById('f-start').value,end:document.getElementById('f-end').value,desc:document.getElementById('f-desc').value.trim()};
  if(editingId){const i=contents.findIndex(x=>x.id===editingId);if(i>=0)contents[i]={...contents[i],...data};notify('×¢×•×“×›×Ÿ âœ“');}
  else{contents.push({id:uid(),...data});notify('× ×•×¡×£! ğŸš€','ğŸš€');}
  save(); closeModal(); renderAll();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATUS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function advanceStatus(e,id) {
  e.stopPropagation();
  const order=['idea','production','ready','published'];
  const c=contents.find(x=>x.id===id); if(!c) return;
  const i=order.indexOf(c.status);
  if(i<order.length-1){c.status=order[i+1];save();renderAll();notify(`${STATUSES[c.status].label} âœ“`);}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CTX MENU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openCtxMenu(e,id) {
  e.stopPropagation(); ctxId=id;
  const m=document.getElementById('ctxMenu');
  m.style.top=e.clientY+'px'; m.style.right=(window.innerWidth-e.clientX)+'px'; m.style.left='auto';
  m.classList.add('open');
}
function ctxEdit()          { document.getElementById('ctxMenu').classList.remove('open'); openEditModal(ctxId); }
function ctxWand()          { document.getElementById('ctxMenu').classList.remove('open'); openScriptModal(null,ctxId); }
function ctxAdvanceStatus() { document.getElementById('ctxMenu').classList.remove('open'); advanceStatus({stopPropagation:()=>{}},ctxId); }
function ctxDelete() {
  document.getElementById('ctxMenu').classList.remove('open');
  const c=contents.find(x=>x.id===ctxId);
  if(c&&confirm(`×œ××—×•×§ ××ª "${c.title}"?`)){contents=contents.filter(x=>x.id!==ctxId);save();renderAll();notify('× ××—×§','ğŸ—‘ï¸');}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• IDEA MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openIdeaModal() {
  editingIdeaId=null;
  ['i-title','i-emoji','i-body','i-tags'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('ideaModal').classList.add('open');
  setTimeout(()=>document.getElementById('i-title').focus(),100);
}
function closeIdeaModal() { document.getElementById('ideaModal').classList.remove('open'); }
function saveIdea() {
  const title=document.getElementById('i-title').value.trim();
  if(!title){document.getElementById('i-title').style.borderColor='var(--red)';return;}
  document.getElementById('i-title').style.borderColor='';
  const data={title,emoji:document.getElementById('i-emoji').value.trim()||'ğŸ’¡',body:document.getElementById('i-body').value.trim(),tags:document.getElementById('i-tags').value.split(',').map(t=>t.trim()).filter(Boolean)};
  if(editingIdeaId){const i=ideas.findIndex(x=>x.id===editingIdeaId);if(i>=0)ideas[i]={...ideas[i],...data};}
  else ideas.push({id:uid(),...data});
  save(); closeIdeaModal(); renderIdeas(); notify('×¨×¢×™×•×Ÿ × ×©××¨! ğŸ’¡','ğŸ’¡');
}
function editIdea(id) {
  const idea=ideas.find(x=>x.id===id); if(!idea) return;
  editingIdeaId=id;
  document.getElementById('i-title').value=idea.title; document.getElementById('i-emoji').value=idea.emoji||'';
  document.getElementById('i-body').value=idea.body||''; document.getElementById('i-tags').value=(idea.tags||[]).join(', ');
  document.getElementById('ideaModal').classList.add('open');
}
function deleteIdea(e,id) {
  e.stopPropagation(); ideas=ideas.filter(x=>x.id!==id); save(); renderIdeas(); notify('× ××—×§','ğŸ—‘ï¸');
}
function convertIdeaToContent(id) {
  const idea=ideas.find(x=>x.id===id); if(!idea) return;
  editingId=null;
  document.getElementById('modalTitle').textContent='×”××¨ ×¨×¢×™×•×Ÿ ×œ×ª×•×›×Ÿ';
  document.getElementById('f-title').value=idea.title; document.getElementById('f-desc').value=idea.body||'';
  document.getElementById('f-status').value='idea'; selectedPlatform='instagram';
  document.querySelectorAll('.platform-option').forEach(o=>o.classList.toggle('selected',o.dataset.platform==='instagram'));
  const t=new Date().toISOString().slice(0,10), nw=new Date(Date.now()+7*86400000).toISOString().slice(0,10);
  document.getElementById('f-start').value=t; document.getElementById('f-end').value=nw;
  document.getElementById('contentModal').classList.add('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TABS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(name,el) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  el.classList.add('active'); document.getElementById('tab-'+name).classList.add('active');
}
</script>
</body>
</html>
